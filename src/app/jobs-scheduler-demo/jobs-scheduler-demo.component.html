<div class="main-content" style="margin-top: 70px;">
    <div class="row">
        <div class="col-md-2">
            <div class="d-block"></div>
        </div>

        <div class="col-md-8">
            <div class="d-block shadow-sm mb-2" style="border-radius: 10px; background-color: #F5FFFF;">
                <div class="text-center">

                    <!-- Dropdown filters (single select)-->
                    <ng-container *ngFor="let item of this.APP['Data'].Dropdown_filters">
                        <div class="d-inline-block">

                            <!-- Tag chips inputs -->
                            <tag-input theme="bootstrap-info"
                                       [(ngModel)]="item.value"
                                       [maxItems]="1"
                                       [removable]="true"
                                       [onlyFromAutocomplete]="true"
                                       [displayBy]="'label'"
                                       [identifyBy]="'filter_Id'"
                                       [secondaryPlaceholder]="item.label + ' ?'"
                                       (onAdd)="tags_filter_onItemAdded(item)"
                                       (onRemove)="tags_filter_onItemRemoved(item)">
                                <tag-input-dropdown [autocompleteItems]="tags_filter_requestAutocompleteItems(item.data)"
                                                    [showDropdownIfEmpty]="true"
                                                    [displayBy]="'label'"
                                                    [identifyBy]="'Id'"
                                                    [appendToBody]="true">
                                    <ng-template let-item="item">{{item.label}}</ng-template>
                                </tag-input-dropdown>
                            </tag-input>
                            </div>

                    </ng-container>
                </div>
            </div>
        </div>

        <div class="col-md-2">
            <div class="d-block"></div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-2 px-0">

            <div class="card">
                <div class="card-header">
                    <div class="text-center">
                        <h5 class="mb-0 text-uppercase">Job cards</h5>
                    </div>
                </div>
                <div class="card-body">

                    <!-- New Job -->
                    <div class="text-center">
                        <a ngbButton class="btn btn-sm btn-outline-primary btn-round w-100"
                           (click)="jobForm_modal('new', 'job', null)">New job
                        </a>
                    </div>

                    <div id="accordion" role="tablist" aria-multiselectable="true" class="card-collapse">

                        <div class="card card-plain">
                            <div role="tab" id="headingThree" class="card-header">
                                <a data-toggle="collapse" data-parent="#accordion" href="#collapse_3" aria-expanded="false" aria-controls="collapse_3" class="collapsed">{{this.APP['Data'].Draggable.Employee.label}}
                                    <i class="nc-icon nc-minimal-down"></i>
                                </a>
                            </div>
                            <div id="collapse_3" role="tabpanel" aria-labelledby="headingThree" class="collapse">
                                <ng-container *ngIf="this.APP['Data'].Draggable.Employee as draggable">
                                    <div class="event-draggable noUi-target mb-1"
                                         *ngFor="let item of draggable.events"
                                         [ngClass]="[calendar && calendar.state.viewType != 'dayGridMonth' || item.duration_num >=24 ? 'fc-draggable' : 'blurred', item.className]"
                                         [attr.data-event]="object_to_JSON(draggable, item)"

                                         [ngbPopover]="job_pop_Content"
                                         popoverTitle=""
                                         [autoClose]="'outside'"
                                         popoverClass="jobCard_pop"
                                         placement="right-bottom"
                                         triggers="manual"
                                         #p="ngbPopover"
                                         (click)="jobCard_pop_Toggle(p, item, this.APP['Data'].Draggable.Employee)">{{item.title}}
                                    </div>
                                </ng-container>
                            </div>
                        </div>

                        <div class="card card-plain">
                            <div role="tab" id="headingTwo" class="card-header">
                                <a data-toggle="collapse" data-parent="#accordion" href="#collapse_2" aria-expanded="false" aria-controls="collapse_2" class="collapsed">{{this.APP['Data'].Draggable.Scheduler.label}}
                                    <i class="nc-icon nc-minimal-down"></i>
                                </a>
                            </div>
                            <div id="collapse_2" role="tabpanel" aria-labelledby="headingTwo" class="collapse">
                                <ng-container *ngIf="this.APP['Data'].Draggable.Scheduler as draggable">
                                    <div class="event-draggable noUi-target mb-1"
                                         *ngFor="let item of draggable.events"
                                         [ngClass]="[calendar && calendar.state.viewType != 'dayGridMonth' || item.duration_num >=24 ? 'fc-draggable' : 'blurred', item.className]"
                                         [attr.data-event]="object_to_JSON(draggable, item)"

                                         [ngbPopover]="job_pop_Content"
                                         popoverTitle=""
                                         [autoClose]="'outside'"
                                         popoverClass="jobCard_pop"
                                         placement="right-bottom"
                                         triggers="manual"
                                         #p="ngbPopover"
                                         (click)="jobCard_pop_Toggle(p, item, this.APP['Data'].Draggable.Scheduler)">{{item.title}}
                                    </div>
                                </ng-container>
                            </div>
                        </div>

                        <div class="card card-plain">
                            <div role="tab" id="headingOne" class="card-header">
                                <a data-toggle="collapse" data-parent="#accordion" href="#collapse_1" aria-expanded="false" aria-controls="collapse_1" class="collapsed">{{this.APP['Data'].Draggable.SubContractor.label}}
                                    <i class="nc-icon nc-minimal-down"></i>
                                </a>
                            </div>
                            <div id="collapse_1" role="tabpanel" aria-labelledby="headingOne" class="collapse">
                                <ng-container *ngIf="this.APP['Data'].Draggable.SubContractor as draggable">
                                    <div class="event-draggable noUi-target mb-1"
                                         *ngFor="let item of draggable.events"
                                         [ngClass]="[calendar && calendar.state.viewType != 'dayGridMonth' || item.duration_num >=24 ? 'fc-draggable' : 'blurred', item.className]"
                                         [attr.data-event]="object_to_JSON(draggable, item)"

                                         [ngbPopover]="job_pop_Content"
                                         popoverTitle=""
                                         [autoClose]="'outside'"
                                         popoverClass="jobCard_pop"
                                         placement="right-bottom"
                                         triggers="manual"
                                         #p="ngbPopover"
                                         (click)="jobCard_pop_Toggle(p, item, this.APP['Data'].Draggable.SubContractor)">{{item.title}}
                                    </div>
                                </ng-container>
                            </div>
                        </div>

                        <div class="card card-plain">
                            <div role="tab" id="headingFour" class="card-header">
                                <a data-toggle="collapse" data-parent="#accordion" href="#collapse_4" aria-expanded="false" aria-controls="collapse_4" class="collapsed">{{this.APP['Data'].Draggable.Jobs.label}}
                                    <i class="nc-icon nc-minimal-down"></i>
                                </a>
                            </div>
                            <div id="collapse_4" role="tabpanel" aria-labelledby="headingFour" class="collapse">
                                <ng-container *ngIf="this.APP['Data'].Draggable.Jobs as draggable">
                                    <div class="event-draggable noUi-target mb-1"
                                         *ngFor="let item of draggable.events"
                                         [ngClass]="[calendar && calendar.state.viewType != 'dayGridMonth' || item.duration_num >=24 ? 'fc-draggable' : 'blurred', item.className]"
                                         [attr.data-event]="object_to_JSON(draggable, item)"

                                         [ngbPopover]="job_pop_Content"
                                         popoverTitle=""
                                         [autoClose]="'outside'"
                                         popoverClass="jobCard_pop"
                                         placement="right-bottom"
                                         triggers="manual"
                                         #p="ngbPopover"
                                         (click)="jobCard_pop_Toggle(p, item, this.APP['Data'].Draggable.Jobs)">{{item.title}}
                                    </div>
                                </ng-container>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-8">
            <div class="card card-calendar">
                <div class="card-content">
                    <div id="jobsScheduler"></div>
                </div>
            </div>
        </div>

        <div class="col-md-2 px-0">
            <div class="d-block"></div>
        </div>
    </div>
</div>


<!-- fullCalendar event pop-over -->
<ng-template #event_pop_Content let-event="event" let-popover="popover">

    <div style="position: absolute; right: 0; top: 0;">
        <span ngbDropdown class="no-arrow">
            <button type="button" ngbDropdownToggle rel="tooltip" title="Delete Job schedule" class="btn btn-danger btn-round btn-icon btn-icon-mini btn-neutral">
                <i class="nc-icon nc-simple-remove"></i>
            </button>
            <div ngbDropdownMenu>
                <div ngbDropdownItem class="text-info">Cancel</div>
                <div ngbDropdownItem class="text-danger" (click)="popover.close(); eventCard_pop_delete(event)">Delete this Job</div>
            </div>
        </span>
        <button type="button" rel="tooltip" title="Update Job schedule" class="btn btn-info btn-round btn-icon btn-icon-mini btn-neutral">
            <i class="nc-icon nc-ruler-pencil" (click)="popover.close(); eventCard_pop_edit(event)"></i>
        </button>
    </div>

    <h6 class="card-subtitle text-muted">Title</h6>
    <p>{{event.title}}</p>

    <h6 class="card-subtitle text-muted">Start</h6>
    <p>{{event.start | date:'medium'}}</p>

    <ng-container *ngIf="event.end">
        <h6 class="card-subtitle text-muted">End</h6>
        <p>{{event.end | date:'medium'}}</p>
    </ng-container>

    <h6 class="card-subtitle text-muted">Job Type</h6>
    <p class="p-sm-1 fc-event" [ngClass]="[event.extendedProps.Job_Type.className]">{{event.extendedProps.Job_Type.label}}</p>

    <h6 class="card-subtitle text-muted">Tags</h6>
    <p class="mb-0" *ngFor="let tag of event.extendedProps.tags">{{tag.label}} | {{tag.value.label}}</p>

</ng-template><!-- #fullCalendar event pop-over -->


<!-- draggable jobs pop-over -->
<ng-template #job_pop_Content let-item="item" let-draggable="draggable" let-popover="popover">

    <div style="position: absolute; right: 0; top: 0;">
        <span ngbDropdown class="no-arrow">
            <button type="button" ngbDropdownToggle rel="tooltip" title="Delete Job card" class="btn btn-danger btn-round btn-icon btn-icon-mini btn-neutral">
                <i class="nc-icon nc-simple-remove"></i>
            </button>
            <div ngbDropdownMenu>
                <div ngbDropdownItem class="text-info">Cancel</div>
                <div ngbDropdownItem class="text-danger" (click)="popover.close(); jobCard_pop_delete(draggable, item)">Delete this Job</div>
            </div>
        </span>
        <span ngbDropdown class="no-arrow">
            <button type="button" ngbDropdownToggle rel="tooltip" title="Clone Job card" class="btn btn-info btn-round btn-icon btn-icon-mini btn-neutral">
                <i class="nc-icon nc-simple-add"></i>
            </button>
            <div ngbDropdownMenu>
                <div ngbDropdownItem class="text-info">Cancel</div>
                <div ngbDropdownItem class="text-danger" (click)="popover.close(); jobCard_pop_clone(draggable, item)">Clone this Job</div>
            </div>
        </span>
        <button type="button" rel="tooltip" title="Update Job card" class="btn btn-info btn-round btn-icon btn-icon-mini btn-neutral">
            <i class="nc-icon nc-ruler-pencil" (click)="popover.close(); jobCard_pop_edit(draggable, item)"></i>
        </button>
    </div>

    <h6 class="card-subtitle text-muted">Title</h6>
    <p>{{item.title}}</p>

    <h6 class="card-subtitle text-muted">Duration</h6>
    <p>{{item.duration}} h</p>

    <h6 class="card-subtitle text-muted">Tags</h6>
    <p class="mb-0" *ngFor="let tag of item.extendedProps.tags">{{tag.label}} | {{tag.value.label}}</p>

</ng-template><!-- #draggable jobs pop-over -->


<!--  draggable jobs or fullCalendar event modal -->
<ng-template #job_modal let-modal>

    <div class="modal-header">
        <h4 class="modal-title"><b>{{jobForm_data_modal.modal_mode == 'new' ? 'New ' : 'Update '}}{{jobForm_data_modal.modal_type == 'job' ? 'Job card' : 'Job schedule'}}</b></h4>
    </div>
    <div class="modal-body">
        <div class="col-md-12 px-0">

            <!-- Title -->
            <div class="form-group">
                <div class="font-weight-bold"><span class="text-danger">* </span>Job title</div>
                <input class="form-control" type="text" placeholder="Enter a title" [(ngModel)]="jobForm_data_modal.title">
            </div>

            <div class="row">
                <div class="col-md-3 pr-2">

                    <ng-container [ngSwitch]="jobForm_data_modal.modal_mode">
                        <!-- Dropdown Job Type (single select) -->
                        <form *ngSwitchCase="'new'" class="form-inline">
                            <div class="btn-group" role="group" aria-label="Button group with nested dropdown"
                                 ngbDropdown [placement]="'bottom-left'" autoClose="both">
                                <a ngbButton class="btn btn-sm btn-outline-primary btn-round" ngbDropdownToggle>
                                    <span class="text-danger">* </span>Job type
                                </a>
                                <div class="dropdown-menu" ngbDropdownMenu>
                                    <ng-container *ngFor="let item of jobForm_data_modal.choices_Job_Type">
                                        <div ngbDropdownItem
                                             [ngClass]="item.selected && 'checked'"
                                             (click)="new_event_dropdown_Job_Type_clicked(item)">{{item.label}}
                                        </div>
                                    </ng-container>
                                </div>
                            </div>
                        </form>

                        <form *ngSwitchCase="'update'" class="form-inline">
                            <div class="font-weight-bold pb-1">Job type</div>
                        </form>

                        <!-- Selected Job Type -->
                        <div class="p-sm-1 fc-event"
                             *ngIf="jobForm_data_modal.Job_Type_selected"
                             [ngClass]="[jobForm_data_modal.Job_Type_selected.className]">{{jobForm_data_modal.Job_Type_selected.label}}
                        </div>
                    </ng-container >
                </div>

                <div class="col-md-2 px-0">

                    <!-- Dropdown Tags (multi-select) -->
                    <form class="form-inline">
                        <div class="btn-group" role="group" aria-label="Button group with nested dropdown"
                             ngbDropdown [placement]="'bottom-left'" autoClose="outside">
                            <a ngbButton class="btn btn-sm btn-outline-primary btn-round" ngbDropdownToggle>Tags </a>
                            <div class="dropdown-menu" ngbDropdownMenu style="max-height: 200px; overflow-y: auto;">
                                <ng-container *ngFor="let item of jobForm_data_modal.choices_Tag_Type">
                                    <div ngbDropdownItem
                                          [ngClass]="item.selected && 'checked'"
                                          (click)="item.selected = !item.selected">{{item.label}}
                                    </div>
                                </ng-container>
                            </div>
                        </div>
                    </form>
                </div>

                <div class="col-md-7 px-0">

                    <!-- Tag chips inputs -->
                    <ng-container *ngFor="let item of jobForm_data_modal.choices_Tag_Type">
                        <span *ngIf="item.selected" class="d-inline-flex">
                            <tag-input theme="bootstrap-info"
                                       [(ngModel)]="item.value"
                                       [maxItems]="1"
                                       [removable]="true"
                                       [onlyFromAutocomplete]="true"
                                       [displayBy]="'label'"
                                       [identifyBy]="'filter_Id'"
                                       [secondaryPlaceholder]="item.label + ' ?'">
                                <tag-input-dropdown [autocompleteItems]="tags_filter_requestAutocompleteItems(item.data)"
                                                    [showDropdownIfEmpty]="true"
                                                    [displayBy]="'label'"
                                                    [identifyBy]="'Id'"
                                                    [appendToBody]="false">
                                    <ng-template let-item="item">{{item.label}}</ng-template>
                                </tag-input-dropdown>
                            </tag-input>
                        </span>
                    </ng-container>
                </div>
            </div>

<!--            <pre>Selected Tags: {{my_event_selected_Tag_chips() | json}}</pre>-->

            <ng-template [ngIf]="jobForm_data_modal.modal_type !='scheduler'" [ngIfElse]="scheduler_edit_mode"></ng-template>
            <ng-template [ngIf]="jobForm_data_modal.modal_type !='job'" [ngIfElse]="job_edit_mode"></ng-template>

            <!-- Job edit mode -->
            <ng-template #job_edit_mode>
                <hr>

                <!-- Time range picker -->
                <div class="d-flex flex-row justify-content-start">
                    <div class="mr-5">
                        <div class="font-weight-bold mt-1">Duration</div>
                        <div class="mt-2">
                            <a ngbButton class="btn btn-sm btn-outline-primary btn-round"
                               (click)="new_event_set_duration(00, 24, 0)">Set all day
                            </a>
                        </div>
                    </div>

                    <div>
                        <div class="d-flex flex-row justify-content-around">
                            <div>&nbsp;&nbsp;<small>Days</small>&nbsp;&nbsp;</div>
                            <div>&nbsp;<small>Hours</small>&nbsp;</div>
                            <div><small>Minutes</small></div>
                        </div>
                        <div style="margin-top: -10px">
                            <ngb-timepicker
                                    [(ngModel)]="jobForm_data_modal.start_time"
                                    (ngModelChange)="new_event_time_changed()"
                                    [spinners]="true"
                                    [meridian]="false"
                                    [seconds]="true"
                                    [secondStep]="30"
                                    [size]="'small'">
                            </ngb-timepicker>
                        </div>
                    </div>

                </div>
            </ng-template><!-- #Job edit mode -->


            <!-- Scheduler edit mode -->
            <ng-template #scheduler_edit_mode>

                <!-- Date range picker -->
                <ng-container *ngIf="jobForm_data_modal.fullCalendar_view_type != 'timeGridDay'">
                    <form class="form-inline">
                        <div class="font-weight-bold mr-4" style="padding-top: 10px;">Date range</div>
                        <datepicker-range-popup
                                [(fromDate)]="jobForm_data_modal.fromDate"
                                [(fromDate_isValid)]="jobForm_data_modal.fromDate_isValid"
                                [(toDate)]="jobForm_data_modal.toDate"
                                [(toDate_isValid)]="jobForm_data_modal.toDate_isValid"
                                [labelEnabled]="true"
                                [placement]="'Top'">
                        </datepicker-range-popup>
                    </form>
                </ng-container>

                <hr>

                <!-- Time range picker -->
                <div class="d-flex flex-row justify-content-between">
                    <div>
                        <div class="font-weight-bold">Time range</div>
                        <div style="margin-top: 1em;">
                            <a ngbButton class="btn btn-sm btn-outline-primary btn-round"
                               (click)="new_event_set_range(8, 6)">Set 8am to 6pm
                            </a>
                        </div>
                        <div style="position: absolute; bottom: 0;">
                            <a ngbButton class="btn btn-sm btn-outline-primary btn-round"
                               (click)="new_event_set_range(0, 24)">Set all day
                            </a>
                        </div>
                    </div>

                    <!-- Override AM/PM buttons styling for the <ngb-timepicker> component -->
                    <style>
                        #add_event_modal .ngb-tp-meridian button[type=button] {
                            font-size: 0.8571em;
                            padding: 5px 15px;
                            text-decoration: none;
                            color: inherit;
                            background: transparent;
                            border: 2px solid #51cbce !important;
                            opacity: 1;
                            border-radius: 30px;
                        }
                    </style>

                    <div>
                        <div class="text-center"><small>Start</small></div>
                        <div style="margin-top: -10px">
                            <ngb-timepicker
                                    [(ngModel)]="jobForm_data_modal.start_time"
                                    (ngModelChange)="new_event_duration_changed()"
                                    [spinners]="true"
                                    [meridian]="true"
                                    [minuteStep]="30"
                                    [size]="'small'">
                            </ngb-timepicker>
                        </div>
                    </div>

                    <div>
                        <div class="text-center"><small>End</small></div>
                        <div style="margin-top: -10px">
                            <ngb-timepicker
                                    [(ngModel)]="jobForm_data_modal.end_time"
                                    (ngModelChange)="new_event_time_changed()"
                                    [meridian]="true"
                                    [minuteStep]="30"
                                    [size]="'small'">
                            </ngb-timepicker>
                        </div>
                    </div>
                </div>
            </ng-template><!-- #Scheduler edit mode -->

        </div>
    </div>

    <div class="modal-footer">
        <div class="col-md-12 text-center">
            <button type="button" class="btn btn-info mr-md-3" (click)="modal.dismiss('cancel click')">Cancel</button>
            <button type="button" class="btn btn-success" [disabled]="new_event_form_inValid()" (click)="modal.close('Ok click')">Save</button>
        </div>
    </div>

</ng-template><!--  #draggable jobs or fullCalendar event modal -->


<!-- For testing only: Display JSON content -->
<!--            <pre>new_event: {{jobForm_data_modal | json}}</pre>-->


<!--                <div>-->
<!--                    <div class="form-check-radio">-->
<!--                        <label class="form-check-label">-->
<!--                            <input class="form-check-input" type="radio"-->
<!--                                   [(ngModel)]="jobForm_data_modal.all_day"-->
<!--                                   [checked]="!jobForm_data_modal.all_day"-->
<!--                                   [value]="false"-->
<!--                                   (ngModelChange)="new_event_set_all_day()"> Time range-->
<!--                            <span class="form-check-sign"></span>-->
<!--                        </label>-->
<!--                    </div>-->
<!--                    <div class="form-check-radio">-->
<!--                        <label class="form-check-label">-->
<!--                            <input class="form-check-input" type="radio"-->
<!--                                   [(ngModel)]="jobForm_data_modal.all_day"-->
<!--                                   [checked]="jobForm_data_modal.all_day"-->
<!--                                   [value]="true"-->
<!--                                   (ngModelChange)="new_event_set_all_day()"> All day-->
<!--                            <span class="form-check-sign"></span>-->
<!--                        </label>-->
<!--                    </div>-->
<!--                </div>-->


<!--            <ng-select-->
<!--                    [items]="jobForm_data_modal.choices_Tag_Type"-->
<!--                    [multiple]="true"-->
<!--                    [hideSelected]="false"-->
<!--                    [closeOnSelect]="false"-->
<!--                    [selectableGroupAsModel]="false"-->
<!--                    [searchable]="false"-->
<!--                    bindLabel="label"-->
<!--                    placeholder="Select tag categories"-->
<!--                    [(ngModel)]="jobForm_data_modal.selected_choices_Tag_Type">-->
<!--            </ng-select>-->


<!-- vertical align -->
<!--<div style="position: relative; top:50%; transform: translateY(-50%);"></div>-->
